<!DOCTYPE html>
<html>
<head>
    <title>iSales | Zusammenfassung</title>
    <link rel="stylesheet" type="text/css" href="./style/styles.css">

    <script src="./script/script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="./script//urlParameter.js"></script>

</head>
<body>
    <!-- Header-Bereich -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <a href="index.html">
                    <img src="./img/iapplesales-logo-white-transparent.png" alt="iAppleSales - Logo">
                </a>
            </div>
        </div>

        <div class="header-center">
            <h1> Willkommen bei IAppleSales! </h1>
            <nav>
                <ul class="navigation">
                    <li><a href="default_kategorieseite.html?id=1">iPhones</a></li>  
                    <li><a href="default_kategorieseite.html?id=2">iPads</a></li>      
                    <li><a href="default_kategorieseite.html?id=3">iMacs</a></li>      
                    <li><a href="default_kategorieseite.html?id=4">Zubehör</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-right">
            <div class="cart">
                <span class="cart-icon">&#128722;</span>
                <span class="cart-count">0</span>
            </div>
        </div>
    </header>



    <!-- Inhalt der Bestellseite -->
    <div class="container">
        <!-- Warenkorb -->
        <div class="rightSide">
            <h2>Warenkorb</h2>
            <ul id="selected-items"> <div class="content">
                <table class="cart-table" id="basket">
                    <thead>
                    <tr>
                        <th id="article-number">Pos.</th>
                        <th id="article-name">Artikel</th>
                        <th id="unit-price">Einzelpreis</th>
                        <th id="quantity">Menge</th>
                        <th id="total-price">Gesamtpreis</th>
                        <th id="total-price">Aktion</th>
                    </tr>
                    </thead>
                    <tbody id="cart-items-table">
                    <!-- Artikel erscheinen hier -->
                </table>
            </div>
            <button type="button" id="emptyShoppingBasketButton">Warenkorb leeren</button>
        </div>
            <!-- Bestellformular -->
        <div class="leftSide">
            <form id="order-form" action="bestellabschluss.html">
                <h2>Bestellformular</h2>
                <div class="form-group">
                    <label for="anrede">Anrede:</label>
                    <select id="anrede" name="anrede">
                        <option value="Herr">Herr</option>
                        <option value="Frau">Frau</option>
                    </select>
                </div>
                    <div class="form-row">
                    <div class="form-group">
                        <label for="vorname">Vorname:</label>
                        <input type="text" id="vorname" name="vorname" placeholder="Vorname eingeben..." required>
                    </div>
                    <div class="form-group">
                        <label for="nachname">Nachname:</label>
                        <input type="text" id="nachname" name="nachname" placeholder="Nachname eingeben..." required>
                    </div>
                    </div>

                    <div class="form-row">    
                    <div class="form-group">
                        <label for="firma">Firma (optional):</label>
                        <input type="text" id="firma" name="firma" placeholder="Firma eingeben...">
                    </div>
                    <div class="form-group">
                        <label for="ustid">UST-ID (optional):</label>
                        <input type="text" id="ustid" name="ustid" placeholder="UST-ID eingeben...">
                    </div>
                    </div>

                <div class="form-group">
                    <label for="email">E-Mail:</label>
                    <input type="email" id="email" name="email" placeholder="E-Mail eingeben..." required>
                </div>
                <div class="form-group">
                    <label for="strassenr">Straße und Hausnr:</label>
                    <input type="text" id="strasse" name="strasse" placeholder="Straße und Hausnr eingeben..." required>
                </div>

                    <div class="form-row">
                    <div class="form-group">
                        <label for="plz">PLZ:</label>
                        <input type="text" id="plz" name="plz" placeholder="PLZ eingeben..." required>
                    </div>
                    <div class="form-group">
                        <label for="ort">Ort:</label>
                        <input type="text" id="ort" name="ort" placeholder="Ort eingeben..." required>
                    </div>
                    </div>

                <div class="form-group">
                    <label for="land">Land:</label>
                    <input type="text" id="land" name="land" placeholder="Land eingeben..." required>
                </div>

                <div class="form-group">
                    <label class="custom-checkbox">Ich habe die <a href="agb.html">AGB</a> und <a href="datenschutz.html">Datenschutzerklärung</a> gelesen und akzeptiert:
                    <input type="checkbox" id="agb-datenschutz" name="agb-datenschutz" required>
                    <span class="checkmark"></span>
                    </label>
                </div>
                <div class="form-group">
                    <a class="back-to-page-button" href="default_warenkorb.html">zurück zum Warenkorb</a>
                    <button type="submit" class="order-confirmation-button">Kostenpflichtig Bestellen</button>
                </div>
            </form>
        </div>
    </div>
    

    <!-- Footer-Bereich -->
    <footer class="footer">
        &copy; 2023 iAppleSales - Alle Rechte vorbehalten | 
        <a href="about_Us.html">Über Uns</a> | 
        <a href="AGB.html">AGB</a> | 
        <a href="datenschutz.html">Datenschutz</a> | 
        <a href="impressum.html">Impressum</a>
    </footer>

<script>

$('#order-form').submit(function(e) {
    e.preventDefault(); // Verhindert das Neuladen der Seite nach dem Absenden des Formulars

    // Erstelle zunächst die Adresse
    $.ajax({
        url: 'http://localhost:8000/adresse',
        method: 'POST',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify({
            strasse: $('#strasse').val(),
            plz: $('#plz').val(),
            ort: $('#ort').val(),
            landId: $('#land').val() 
        }),
        dataType: 'json',
        success: function(adresseData) {
            console.log('Adresse Erfolg:', adresseData);

            // Erstelle dann die Person
            $.ajax({
                url: 'http://localhost:8000/person',
                method: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    anrede: $('#anrede').val(),
                    vorname: $('#vorname').val(),
                    nachname: $('#nachname').val(),
                    email: $('#email').val()
                }),
                dataType: 'json',
                success: function(personData) {
                    console.log('Person Erfolg:', personData);

                    // Überprüfe, ob Firmendaten vorhanden sind und erstelle gegebenenfalls die Firma
                    if ($('#firma').val() || $('#ustid').val()) {
                        $.ajax({
                            url: 'http://localhost:8000/firma',
                            method: 'POST',
                            contentType: 'application/json; charset=utf-8',
                            data: JSON.stringify({
                                name: $('#firma').val(),
                                ustid: $('#ustid').val(),
                                adresseId: adresseData.id,
                                ansprechpartnerId: personData.id
                            }),
                            dataType: 'json',
                            success: function(firmaData) {
                                console.log('Firma Erfolg:', firmaData);
                            },
                            error: function(xhr, status, error) {
                                console.error('Fehler bei der Erstellung der Firma:', error);
                            }
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Fehler bei der Erstellung der Person:', error);
                }
            });
        },
        error: function(xhr, status, error) {
            console.error('Fehler bei der Erstellung der Adresse:', error);
        }
    });
});



// VON KUTI 
/*
$('#addtax').click(function() {
            console.log('button addtax clicked');
			
			$.ajax({
                url: 'http://localhost:8000/api/mehrwertsteuer',
                method: 'post',
				contentType: 'application/json; charset=utf-8',
                cache: false,
				data: JSON.stringify(obj)
            }).done(function (response) {
                console.log(response);
                $('#output').html(JSON.stringify(response));
            }).fail(function (jqXHR, statusText, error) {
                console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
                $('#output').html('Ein Fehler ist aufgetreten');
            });
        });
*/

</script>
</body>
</html>
